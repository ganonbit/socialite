# Migration `20201104095154-migration`

This migration has been generated by hyliancoder at 11/4/2020, 2:51:54 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."Role" AS ENUM ('USER', 'MODERATOR', 'SUPER_MODERATOR', 'ADMIN')

CREATE TYPE "public"."Social" AS ENUM ('FACEBOOK', 'TWITTER', 'DEVTO', 'LINKEDIN', 'YOUTUBE', 'PERSONAL', 'OTHER')

CREATE TYPE "public"."UserState" AS ENUM ('UNVERIFIED', 'VERIFIED', 'SOFT_BAN', 'PERMA_BAN', 'DISABLED')

CREATE TYPE "public"."ContentState" AS ENUM ('UNPUBLISHED', 'PUBLISHED', 'DRAFT', 'FLAGGED', 'DISABLED', 'DELETED')

CREATE TYPE "public"."UserStatus" AS ENUM ('OFFLINE', 'ONLINE', 'HIDDEN', 'OTHER')

CREATE TABLE "public"."User" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"email" text   NOT NULL ,
"username" text   NOT NULL ,
"firstName" text   NOT NULL ,
"lastName" text   NOT NULL ,
"birthday" timestamp(3)   ,
"bio" text   ,
"image" text   ,
"status" "UserStatus"  NOT NULL DEFAULT E'OFFLINE',
"state" "UserState"  NOT NULL DEFAULT E'UNVERIFIED',
"role" "Role"  NOT NULL DEFAULT E'USER',
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Post" (
"id" SERIAL,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
"state" "ContentState"  NOT NULL DEFAULT E'UNPUBLISHED',
"title" text   NOT NULL ,
"content" text   NOT NULL ,
"image" text   ,
"url" text   NOT NULL ,
"authorId" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Comment" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
"state" "ContentState"  NOT NULL DEFAULT E'UNPUBLISHED',
"content" text   NOT NULL ,
"sentBy" text   ,
"post" integer   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Message" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"state" "ContentState"  NOT NULL DEFAULT E'UNPUBLISHED',
"content" text   NOT NULL ,
"sentBy" text   ,
"channel" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Channel" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."SocialHandle" (
"id" SERIAL,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
"username" text   NOT NULL ,
"provider" "Social"[]  ,
"userId" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."_ChannelToUser" (
"A" text   NOT NULL ,
"B" text   NOT NULL 
)

CREATE UNIQUE INDEX "User.email_unique" ON "public"."User"("email")

CREATE UNIQUE INDEX "User.username_unique" ON "public"."User"("username")

CREATE UNIQUE INDEX "_ChannelToUser_AB_unique" ON "public"."_ChannelToUser"("A", "B")

CREATE INDEX "_ChannelToUser_B_index" ON "public"."_ChannelToUser"("B")

ALTER TABLE "public"."Post" ADD FOREIGN KEY ("authorId")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Comment" ADD FOREIGN KEY ("sentBy")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Comment" ADD FOREIGN KEY ("post")REFERENCES "public"."Post"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Message" ADD FOREIGN KEY ("sentBy")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Message" ADD FOREIGN KEY ("channel")REFERENCES "public"."Channel"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."SocialHandle" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."_ChannelToUser" ADD FOREIGN KEY ("A")REFERENCES "public"."Channel"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_ChannelToUser" ADD FOREIGN KEY ("B")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

DROP TABLE "public"."UserExample"
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201101120236-migration..20201104095154-migration
--- datamodel.dml
+++ datamodel.dml
@@ -1,9 +1,9 @@
 datasource DS {
   // optionally set multiple providers
   // example: provider = ["sqlite", "postgresql"]
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider      = "prisma-client-js"
@@ -11,10 +11,121 @@
 }
 // Define your own datamodels here and run `yarn redwood db save` to create
 // migrations for them.
-// TODO: Please remove the following example:
-model UserExample {
-  id    Int     @id @default(autoincrement())
-  email String  @unique
-  name  String?
+
+//Enums
+enum Role {
+  USER
+  MODERATOR
+  SUPER_MODERATOR
+  ADMIN
 }
+
+enum Social {
+  FACEBOOK
+  TWITTER
+  DEVTO
+  LINKEDIN
+  YOUTUBE
+  PERSONAL
+  OTHER
+}
+
+enum UserState {
+  UNVERIFIED
+  VERIFIED
+  SOFT_BAN
+  PERMA_BAN
+  DISABLED
+}
+
+enum ContentState {
+  UNPUBLISHED
+  PUBLISHED
+  DRAFT
+  FLAGGED
+  DISABLED
+  DELETED
+}
+
+enum UserStatus {
+  OFFLINE
+  ONLINE
+  HIDDEN
+  OTHER
+}
+
+//Models
+model User {
+  id            String         @id @default(uuid())
+  createdAt     DateTime       @default(now())
+  email         String         @unique
+  username      String         @unique
+  firstName     String
+  lastName      String
+  birthday      DateTime?
+  bio           String?
+  image         String?
+  status        UserStatus     @default(OFFLINE)
+  state         UserState      @default(UNVERIFIED)
+  socialHandles SocialHandle[]
+  role          Role           @default(USER)
+  posts         Post[]         @relation
+  messages      Message[]
+  channels      Channel[]
+  comments      Comment[]
+}
+
+model Post {
+  id        Int          @id @default(autoincrement())
+  createdAt DateTime     @default(now())
+  updatedAt DateTime     @updatedAt
+  state     ContentState @default(UNPUBLISHED)
+  title     String
+  content   String
+  image     String?
+  url       String
+  author    User?        @relation(fields: [authorId], references: [id])
+  authorId  String?
+  comments  Comment[]
+}
+
+model Comment {
+  id        String       @id @default(uuid())
+  createdAt DateTime     @default(now())
+  updatedAt DateTime     @updatedAt
+  state     ContentState @default(UNPUBLISHED)
+  content   String
+  sentBy    User?        @relation(fields: [sentById], references: [id])
+  sentById  String?      @map("sentBy")
+  post      Post?        @relation(fields: [postId], references: [id])
+  postId    Int?         @map("post")
+}
+
+model Message {
+  id        String       @id @default(uuid())
+  createdAt DateTime     @default(now())
+  state     ContentState @default(UNPUBLISHED)
+  content   String
+  sentBy    User?        @relation(fields: [sentById], references: [id])
+  sentById  String?      @map("sentBy")
+  channel   Channel?     @relation(fields: [channelId], references: [id])
+  channelId String?      @map("channel")
+}
+
+model Channel {
+  id        String    @id @default(uuid())
+  users     User[]    @relation(references: [id])
+  messages  Message[]
+  createdAt DateTime  @default(now())
+}
+
+model SocialHandle {
+  id        Int      @id @default(autoincrement())
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  username  String
+  provider  Social[]
+  user      User?    @relation(fields: [userId], references: [id])
+  userId    String?
+}
```


